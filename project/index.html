<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>US States (Leaflet w/ AK & HI Insets)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header>
    <h1>US States</h1>
    <p>Leaflet + GeoJSON (Lower 48 + Alaska/Hawaii insets)</p>
  </header>

  <div class="map-wrap">
    <div id="map"></div>

    <div class="inset">
      <div id="map-ak" class="inset-map" title="Alaska"></div>
      <div id="map-hi" class="inset-map" title="Hawaii"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ---- Styles (match your D3 colors) ----
    function baseStyle(){
      const css = getComputedStyle(document.documentElement);
      return {
        color: css.getPropertyValue("--stroke").trim(),
        weight: 1,
        fillColor: css.getPropertyValue("--land").trim(),
        fillOpacity: 0.95
      };
    }

    function hoverStyle(){
      const css = getComputedStyle(document.documentElement);
      return {
        color: "#ffffff",
        weight: 2,
        fillColor: css.getPropertyValue("--hover").trim(),
        fillOpacity: 1
      };
    }

    function attachInteractions(feature, layer){
      const name = feature?.properties?.name || feature?.id || "State";

      layer.bindTooltip(name, {
        sticky: true,
        direction: "auto",
        className: "state-tooltip"
      });

      layer.on("mouseover", () => layer.setStyle(hoverStyle()));
      layer.on("mouseout", () => layer.setStyle(baseStyle()));
    }

    // ---- Create 3 maps: main + 2 insets ----
    const mainMap = L.map("map", {
      zoomControl: false,
      attributionControl: false,
      preferCanvas: true,
      dragging: true,
      scrollWheelZoom: true
    });

    const akMap = L.map("map-ak", {
      zoomControl: false,
      attributionControl: false,
      preferCanvas: true,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false,
      keyboard: false,
      tap: false
    });

    const hiMap = L.map("map-hi", {
      zoomControl: false,
      attributionControl: false,
      preferCanvas: true,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false,
      keyboard: false,
      tap: false
    });

    // Optional: stop clicks on inset from panning main map (extra safe)
    L.DomEvent.disableClickPropagation(document.getElementById("map-ak"));
    L.DomEvent.disableClickPropagation(document.getElementById("map-hi"));

    // ---- Load GeoJSON once, split into layers ----
    fetch("us-states.json") // <-- your file name
      .then(r => r.json())
      .then(data => {

        const isAK = f => (f?.properties?.name === "Alaska" || f?.id === "02");
        const isHI = f => (f?.properties?.name === "Hawaii" || f?.id === "15");
        const isDC = f => (f?.properties?.name === "District of Columbia" || f?.id === "11");

        // Lower 48 = everything except Alaska & Hawaii (keep DC if you want)
        const lower48 = {
          type: "FeatureCollection",
          features: data.features.filter(f => !isAK(f) && !isHI(f))
        };

        const alaska = {
          type: "FeatureCollection",
          features: data.features.filter(isAK)
        };

        const hawaii = {
          type: "FeatureCollection",
          features: data.features.filter(isHI)
        };

        // --- Main layer (lower 48) ---
        const lowerLayer = L.geoJSON(lower48, {
          style: baseStyle,
          onEachFeature: attachInteractions
        }).addTo(mainMap);

        mainMap.fitBounds(lowerLayer.getBounds(), { padding: [20, 20] });

        // --- Alaska inset ---
        const akLayer = L.geoJSON(alaska, {
          style: baseStyle,
          onEachFeature: attachInteractions
        }).addTo(akMap);

        if (akLayer.getBounds().isValid()) {
          akMap.fitBounds(akLayer.getBounds(), { padding: [10, 10] });
        }

        // --- Hawaii inset ---
        const hiLayer = L.geoJSON(hawaii, {
          style: baseStyle,
          onEachFeature: attachInteractions
        }).addTo(hiMap);

        if (hiLayer.getBounds().isValid()) {
          hiMap.fitBounds(hiLayer.getBounds(), { padding: [10, 10] });
        }

        // ---- "Zoom it in" a bit like D3's framing ----
        // After fitting, zoom in one level for a tighter look:
        mainMap.setZoom(mainMap.getZoom() + 1);

      })
      .catch(err => console.error("Failed to load us-states.json:", err));
  </script>
</body>
</html>
