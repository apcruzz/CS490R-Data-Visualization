:root{
  --bg:#f7f3ea;
  --ink:#1f1f1f;
  --land:#2b2d42;
  --stroke:#f7f3ea;
  --hover:#ef8354;
  --no-data:#b7bcc8;
}

body{
  margin:0;
  font-family:"Georgia","Times New Roman",serif;
  background: radial-gradient(circle at 20% 20%, #fff6e0, var(--bg));
  color:var(--ink);
}

header{
  padding:24px 24px 8px 24px;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
}

h1{ margin:0 0 6px 0; font-size:26px; }
p{ margin:0; opacity:.75; }

.view-tabs{
  display: flex;
  gap: 10px;
  padding-top: 2px;
  flex-shrink: 0;
}

.view-tab{
  border: 1px solid rgba(0,0,0,0.18);
  border-radius: 999px;
  background: rgba(255,255,255,0.78);
  color: #1f1f1f;
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
}

.view-tab.is-active{
  background: #1f4f66;
  border-color: #1f4f66;
  color: #fff;
}

.tab-panel{
  display: none;
}

.tab-panel.is-active{
  display: block;
}

/* Container holds main map + inset maps */
.map-wrap{
  position:relative;
  width:100vw;
  height:80vh;
}

.charts-wrap{
  padding: 28px 24px 24px;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
  max-width: 1320px;
  margin: 0 auto;
}

.chart-card{
  background: rgba(255,255,255,0.86);
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: 14px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.08);
  padding: 12px;
  height: 550px;
  overflow: hidden;
}

.chart-card h3{
  margin: 0 0 10px;
  font-size: 15px;
}

.chart-card canvas{
  width: 100%;
  height: 500px !important;
}

.chart-wide{
  grid-column: auto;
}

#map{
  position:absolute;
  inset:0;
  background:transparent;
}

.leaflet-container{ background:transparent; }

/* Insets bottom-right */
.inset{
  position:absolute;
  right:16px;
  bottom:16px;
  display:flex;
  gap:12px;
  z-index:999; /* above map */
  pointer-events:auto;
}

.inset-map{
  width:180px;
  height:120px;
  border-radius:12px;
  box-shadow:0 10px 24px rgba(0,0,0,.14);
  border:1px solid rgba(255,255,255,.65);
  background: rgba(255,255,255,0.08);
  overflow:hidden;
}

.leaflet-tooltip.state-tooltip{
  background: rgba(255,255,255,0.95);
  border: 1px solid #ddd;
  padding: 8px 10px;
  border-radius: 6px;
  font-size: 12px;
  line-height: 1.35;
  box-shadow: 0 6px 16px rgba(0,0,0,0.12);
  color: #111;
}

.leaflet-tooltip.state-tooltip .tooltip-title{
  font-weight: 700;
  margin-bottom: 4px;
}

.state-name-label-wrap{
  background: transparent;
  border: 0;
}

.state-name-label{
  display: inline-block;
  font-size: 9px;
  font-weight: 700;
  color: #ffffff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
  white-space: nowrap;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

.map-legend,
.map-pill{
  background: rgba(255,255,255,0.94);
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 8px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.10);
  color: #171717;
}

.map-legend{
  padding: 6px 8px;
  font-size: 10px;
  line-height: 1.25;
  min-width: 132px;
}

.legend-title{
  font-weight: 700;
  margin-bottom: 8px;
}

.legend-row{
  display: flex;
  align-items: center;
  gap: 6px;
  margin: 3px 0;
  white-space: nowrap;
}

.swatch{
  width: 10px;
  height: 10px;
  border-radius: 2px;
  border: 1px solid rgba(0,0,0,0.15);
  display: inline-block;
  flex: 0 0 10px;
}

.legend-note{
  margin-top: 4px;
  opacity: 0.75;
  font-size: 9px;
}

.map-pill{
  padding: 5px 7px;
  font-size: 10px;
  margin-top: 10px;
}

.quiz-fab{
  position: fixed;
  left: 18px;
  bottom: 56px;
  z-index: 1200;
  border: 0;
  border-radius: 999px;
  width: 248px;
  padding: 12px 16px;
  font-size: 13px;
  font-weight: 700;
  color: #ffffff;
  background: #1f4f66;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
  cursor: pointer;
  text-align: center;
}

.quiz-fab:hover{
  background: #173b4d;
}

.avatar-controls{
  position: fixed;
  left: 18px;
  bottom: 18px;
  z-index: 1200;
  display: flex;
  width: 248px;
  gap: 8px;
}

.avatar-btn{
  border: 0;
  border-radius: 10px;
  flex: 1;
  padding: 9px 12px;
  font-size: 12px;
  font-weight: 700;
  color: #ffffff;
  background: #2b677e;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
  cursor: pointer;
}

.avatar-btn:hover{
  background: #23556a;
}

.avatar-btn.danger{
  background: #91423c;
}

.avatar-btn.danger:hover{
  background: #7c3833;
}

.quiz-panel{
  position: fixed;
  right: 16px;
  bottom: 16px;
  width: min(360px, calc(100vw - 24px));
  max-height: min(78vh, 620px);
  overflow: auto;
  z-index: 1300;
  background: #fffdf8;
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.22);
  padding: 14px;
  transform: translateY(18px) scale(0.98);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity .2s ease, transform .2s ease, visibility .2s ease;
}

.quiz-panel.open{
  transform: translateY(0) scale(1);
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

.quiz-panel-header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 8px;
}

.quiz-panel-header h2{
  margin: 0;
  font-size: 18px;
}

.quiz-close-btn{
  border: 0;
  background: transparent;
  font-size: 18px;
  cursor: pointer;
  line-height: 1;
}

.quiz-body{
  padding: 6px 0 8px;
}

.quiz-name-wrap{
  display: grid;
  gap: 6px;
  margin-bottom: 8px;
}

.quiz-name-input{
  border: 1px solid #cfd4d8;
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 14px;
}

.quiz-name-input:focus{
  outline: 2px solid #7da6bb;
  outline-offset: 1px;
}

.quiz-check-row{
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  margin: 4px 0 8px;
  cursor: pointer;
}

.quiz-check-row input{
  margin: 0;
}

.quiz-gender-group{
  display: grid;
  gap: 2px;
  margin-bottom: 8px;
}

.quiz-gender-options{
  display: flex;
  align-items: center;
  gap: 16px;
}

.quiz-gender-options .quiz-check-row{
  margin: 0;
}

.quiz-progress{
  font-size: 12px;
  opacity: 0.7;
  margin-bottom: 8px;
}

.quiz-helper{
  margin: 0;
  font-size: 12px;
  opacity: 0.75;
}

.quiz-question{
  margin: 0 0 12px;
  font-size: 18px;
  line-height: 1.3;
}

.quiz-options{
  display: grid;
  gap: 8px;
}

.quiz-option{
  width: 100%;
  border: 1px solid #d8d8d8;
  border-radius: 10px;
  background: #ffffff;
  padding: 10px 12px;
  text-align: left;
  cursor: pointer;
  font-size: 14px;
}

.quiz-option:hover,
.quiz-option.active{
  border-color: #1f4f66;
  background: #e9f3f8;
}

.quiz-controls{
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 6px;
}

.quiz-nav-btn,
.quiz-restart{
  border: 1px solid #cfd4d8;
  border-radius: 8px;
  padding: 8px 12px;
  background: #ffffff;
  cursor: pointer;
}

.quiz-nav-btn.primary,
.quiz-restart{
  background: #1f4f66;
  color: #ffffff;
  border-color: #1f4f66;
}

.quiz-nav-btn:disabled{
  opacity: 0.45;
  cursor: not-allowed;
}

.quiz-top3 ol{
  margin: 8px 0 0 18px;
  padding: 0;
}

.quiz-top3 li{
  margin: 4px 0;
}

.quiz-top3 span{
  opacity: 0.75;
}

.state-avatar-wrap{
  background: transparent;
  border: 0;
}

.state-avatar-slot{
  width: 64px;
  margin: 0 auto;
}

.state-avatar-person{
  width: 64px;
  height: 86px;
  position: relative;
  display: grid;
  justify-items: center;
}

.state-avatar-image{
  width: 56px;
  height: 68px;
  object-fit: cover;
  border-radius: 0;
  border: 0;
  box-shadow: none;
}

.person-label{
  margin-top: 5px;
  padding: 2px 6px;
  border-radius: 999px;
  background: #fff;
  border: 1px solid #1b1b1b;
  font-size: 10px;
  font-weight: 700;
}

@media (max-width: 720px){
  header{
    padding: 16px 12px 8px 12px;
    flex-direction: column;
    gap: 10px;
  }

  .view-tabs{
    padding: 0;
  }

  .charts-wrap{
    padding: 16px 12px 16px;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .chart-card canvas{
    height: 10px !important;
  }

  .quiz-fab{
    left: 12px;
    bottom: 50px;
    width: 224px;
    padding: 10px 14px;
  }

  .avatar-controls{
    left: 12px;
    bottom: 12px;
    width: 224px;
    gap: 6px;
  }

  .quiz-panel{
    right: 12px;
    bottom: 58px;
    max-height: 72vh;
  }
}
